<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - UMak COOP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../../js/notifications.js"></script>
    <script src="../../js/inventory_helper.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Header -->
    <header class="bg-gradient-to-r from-blue-900 via-blue-800 to-blue-900 text-white shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-orange-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-graduation-cap text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">Q-Mak Student Hub</h1>
                        <p id="welcomeText" class="text-blue-200 text-sm">
                            <i class="fas fa-circle text-green-400 text-xs animate-pulse"></i> Loading...
                        </p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="hidden md:block text-sm text-blue-200">
                        <i class="fas fa-clock mr-1"></i>
                        <span id="currentDateTime">Loading...</span>
                    </div>
                    <button onclick="logout()" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg font-semibold transition-all hover:shadow-lg flex items-center gap-2">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <!-- Quick Actions -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <button onclick="showQuickOrder()" class="group bg-white p-8 rounded-xl shadow-md hover:shadow-2xl transition-all transform hover:-translate-y-1 border-l-4 border-green-500 hover:border-green-600">
                <div class="text-green-600 mb-4 transform group-hover:scale-110 transition-transform">
                    <i class="fas fa-shopping-cart text-5xl"></i>
                </div>
                <h3 class="font-bold text-xl text-gray-800 mb-2">Create New Order</h3>
                <p class="text-gray-600 text-sm">Place a new order quickly and securely</p>
                <div class="mt-4 flex items-center text-green-600 text-sm font-semibold">
                    <span>Get Started</span>
                    <i class="fas fa-arrow-right ml-2 transform group-hover:translate-x-2 transition-transform"></i>
                </div>
            </button>

            <button onclick="showOrderHistory()" class="group bg-white p-8 rounded-xl shadow-md hover:shadow-2xl transition-all transform hover:-translate-y-1 border-l-4 border-blue-500 hover:border-blue-600">
                <div class="text-blue-600 mb-4 transform group-hover:scale-110 transition-transform">
                    <i class="fas fa-history text-5xl"></i>
                </div>
                <h3 class="font-bold text-xl text-gray-800 mb-2">Order History</h3>
                <p class="text-gray-600 text-sm">View and track your past orders</p>
                <div class="mt-4 flex items-center text-blue-600 text-sm font-semibold">
                    <span>View History</span>
                    <i class="fas fa-arrow-right ml-2 transform group-hover:translate-x-2 transition-transform"></i>
                </div>
            </button>

            <button onclick="showProfile()" class="group bg-white p-8 rounded-xl shadow-md hover:shadow-2xl transition-all transform hover:-translate-y-1 border-l-4 border-purple-500 hover:border-purple-600">
                <div class="text-purple-600 mb-4 transform group-hover:scale-110 transition-transform">
                    <i class="fas fa-user-circle text-5xl"></i>
                </div>
                <h3 class="font-bold text-xl text-gray-800 mb-2">My Profile</h3>
                <p class="text-gray-600 text-sm">View and update your information</p>
                <div class="mt-4 flex items-center text-purple-600 text-sm font-semibold">
                    <span>Manage Profile</span>
                    <i class="fas fa-arrow-right ml-2 transform group-hover:translate-x-2 transition-transform"></i>
                </div>
            </button>
        </div>

        <!-- Main Content Area -->
        <div id="contentArea" class="bg-white rounded-xl shadow-md p-6">
            <!-- Welcome Screen (Default) -->
            <div id="welcomeScreen">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Welcome to Your Dashboard</h2>
                <p class="text-gray-600 mb-4">Select an action above to get started.</p>
                
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mt-6">
                    <h3 class="font-semibold text-blue-900 mb-2">Quick Tips:</h3>
                    <ul class="list-disc list-inside text-gray-700 space-y-1 text-sm">
                        <li>Create orders faster - your information is already saved!</li>
                        <li>Track all your orders in one place</li>
                        <li>Get email notifications for order updates</li>
                        <li>View QR codes for active orders</li>
                    </ul>
                </div>
            </div>

            <!-- Profile Screen -->
            <div id="profileScreen" class="hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">My Profile</h2>
                    <button id="editProfileBtn" onclick="toggleEditProfile()" class="flex items-center gap-2 px-4 py-2 bg-blue-900 text-white rounded-lg hover:bg-blue-800 transition-colors font-semibold">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                        Edit Profile
                    </button>
                </div>
                
                <!-- View Mode -->
                <div id="profileViewMode">
                    <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-xl p-6 mb-6">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="w-20 h-20 bg-blue-900 rounded-full flex items-center justify-center text-white text-3xl font-bold">
                                <span id="profileInitials">--</span>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold text-gray-800" id="profileFullName">-</h3>
                                <p class="text-gray-600" id="profileStudentIdDisplay">-</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl border-2 border-gray-200 p-6">
                            <h3 class="font-bold text-lg text-blue-900 mb-4 flex items-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                                Personal Information
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Student ID</label>
                                    <p id="profileStudentId" class="font-semibold text-gray-800 text-lg">-</p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Full Name</label>
                                    <p id="profileName" class="font-semibold text-gray-800 text-lg">-</p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Email Address</label>
                                    <p id="profileEmail" class="font-semibold text-gray-800 text-lg break-all">-</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl border-2 border-gray-200 p-6">
                            <h3 class="font-bold text-lg text-blue-900 mb-4 flex items-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                                </svg>
                                Academic Information
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="text-sm font-medium text-gray-500">College</label>
                                    <p id="profileCollege" class="font-semibold text-gray-800 text-lg">-</p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Program</label>
                                    <p id="profileProgram" class="font-semibold text-gray-800 text-lg">-</p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Year Level</label>
                                    <p id="profileYear" class="font-semibold text-gray-800 text-lg">-</p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Section</label>
                                    <p id="profileSection" class="font-semibold text-gray-800 text-lg">-</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Edit Mode -->
                <div id="profileEditMode" class="hidden">
                    <form id="editProfileForm" class="space-y-6">
                        <div class="bg-blue-50 rounded-xl p-6">
                            <h4 class="font-semibold text-blue-900 mb-4 flex items-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Note: Student ID and Email cannot be changed
                            </h4>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <h4 class="font-bold text-lg text-blue-900">Personal Information</h4>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">First Name *</label>
                                    <input type="text" id="editFirstName" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Last Name *</label>
                                    <input type="text" id="editLastName" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Middle Initial</label>
                                    <input type="text" id="editMiddleInitial" maxlength="2" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Optional">
                                </div>
                                <div class="bg-gray-50 rounded-lg p-4 border-2 border-gray-200">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Email Address</label>
                                    <div class="flex items-center gap-2">
                                        <i class="fas fa-lock text-gray-400"></i>
                                        <p class="text-gray-600 font-medium" id="editEmailDisplay"></p>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-2">
                                        <i class="fas fa-info-circle"></i>
                                        Email cannot be changed (based on student ID)
                                    </p>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <h4 class="font-bold text-lg text-blue-900">Academic Information</h4>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">College</label>
                                    <input type="text" id="editCollege" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., College of Engineering">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Program</label>
                                    <input type="text" id="editProgram" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., Computer Science">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Year Level</label>
                                    <select id="editYearLevel" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="">Select Year</option>
                                        <option value="1">1st Year</option>
                                        <option value="2">2nd Year</option>
                                        <option value="3">3rd Year</option>
                                        <option value="4">4th Year</option>
                                        <option value="5">5th Year</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Section</label>
                                    <input type="text" id="editSection" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., A, B, C">
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex gap-4 pt-4">
                            <button type="submit" class="flex-1 bg-blue-900 text-white py-3 rounded-lg font-bold hover:bg-blue-800 transition-colors flex items-center justify-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                Save Changes
                            </button>
                            <button type="button" onclick="cancelEditProfile()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg font-bold hover:bg-gray-600 transition-colors flex items-center justify-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Change Password Section -->
                <div class="mt-8 bg-gradient-to-br from-orange-50 to-red-50 rounded-xl p-6 border-l-4 border-orange-500">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="font-bold text-xl text-gray-800 flex items-center gap-2">
                                <i class="fas fa-lock text-orange-500"></i>
                                Change Password
                            </h3>
                            <p class="text-sm text-gray-600 mt-1">Update your password to keep your account secure</p>
                        </div>
                        <button id="toggleChangePasswordBtn" onclick="toggleChangePassword()" class="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors font-semibold flex items-center gap-2">
                            <i class="fas fa-key"></i>
                            <span id="changePasswordBtnText">Change Password</span>
                        </button>
                    </div>
                    
                    <div id="changePasswordForm" class="hidden">
                        <form id="passwordChangeForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Current Password *</label>
                                <div class="relative">
                                    <input type="password" id="currentPassword" required 
                                           class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                                           placeholder="Enter your current password">
                                    <button type="button" onclick="togglePasswordVisibility('currentPassword')" 
                                            class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">New Password *</label>
                                <div class="relative">
                                    <input type="password" id="newPassword" required 
                                           class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                                           placeholder="Enter new password (min. 6 characters)">
                                    <button type="button" onclick="togglePasswordVisibility('newPassword')" 
                                            class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Confirm New Password *</label>
                                <div class="relative">
                                    <input type="password" id="confirmPassword" required 
                                           class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                                           placeholder="Re-enter new password">
                                    <button type="button" onclick="togglePasswordVisibility('confirmPassword')" 
                                            class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                                <div class="flex gap-3">
                                    <i class="fas fa-info-circle text-yellow-600 mt-1"></i>
                                    <div class="text-sm text-yellow-800">
                                        <p class="font-semibold mb-1">Password Requirements:</p>
                                        <ul class="list-disc list-inside space-y-1">
                                            <li>At least 6 characters long</li>
                                            <li>Must match confirmation</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex gap-4 pt-2">
                                <button type="submit" class="flex-1 bg-orange-500 text-white py-3 rounded-lg font-bold hover:bg-orange-600 transition-colors flex items-center justify-center gap-2">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Update Password</span>
                                </button>
                                <button type="button" onclick="toggleChangePassword()" class="flex-1 bg-gray-500 text-white py-3 rounded-lg font-bold hover:bg-gray-600 transition-colors flex items-center justify-center gap-2">
                                    <i class="fas fa-times"></i>
                                    <span>Cancel</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Quick Order Screen -->
            <div id="quickOrderScreen" class="hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Create New Order</h2>
                <form id="quickOrderForm" class="space-y-6">
                    <!-- Quantity Selection -->
                    <div class="bg-blue-50 rounded-xl p-6">
                        <h4 class="text-lg font-semibold text-blue-900 mb-4 flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"></path>
                            </svg>
                            Order Quantity
                        </h4>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">How many items would you like to order? *</label>
                        <div class="grid grid-cols-5 gap-3">
                            <button type="button" onclick="selectQuantity(1)" id="qty1Btn" 
                                    class="py-3 px-4 border-2 border-blue-900 bg-blue-900 text-white rounded-lg font-bold hover:bg-blue-800 transition-all">
                                1
                            </button>
                            <button type="button" onclick="selectQuantity(2)" id="qty2Btn" 
                                    class="py-3 px-4 border-2 border-gray-300 bg-white text-gray-700 rounded-lg font-bold hover:border-blue-900 hover:bg-blue-50 transition-all">
                                2
                            </button>
                            <button type="button" onclick="selectQuantity(3)" id="qty3Btn" 
                                    class="py-3 px-4 border-2 border-gray-300 bg-white text-gray-700 rounded-lg font-bold hover:border-blue-900 hover:bg-blue-50 transition-all">
                                3
                            </button>
                            <button type="button" onclick="selectQuantity(4)" id="qty4Btn" 
                                    class="py-3 px-4 border-2 border-gray-300 bg-white text-gray-700 rounded-lg font-bold hover:border-blue-900 hover:bg-blue-50 transition-all">
                                4
                            </button>
                            <button type="button" onclick="selectQuantity(5)" id="qty5Btn" 
                                    class="py-3 px-4 border-2 border-gray-300 bg-white text-gray-700 rounded-lg font-bold hover:border-blue-900 hover:bg-blue-50 transition-all">
                                5
                            </button>
                        </div>
                    </div>

                    <!-- Item Selection -->
                    <div class="bg-green-50 rounded-xl p-6">
                        <h4 class="text-lg font-semibold text-blue-900 mb-4 flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                            </svg>
                            Item Selection
                        </h4>
                        <div class="space-y-4">
                            <!-- Item 1 -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Item <span id="item1Label">1</span> *</label>
                                <select id="orderItem1" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select Item</option>
                                    <option value="id lace">ID Lace</option>
                                    <option value="uniform">School Uniform</option>
                                    <option value="PE uniform">PE Uniform</option>
                                    <option value="nstp shirt">NSTP Shirt</option>
                                    <option value="patch">School Patch</option>
                                    <option value="book">Book/Manual</option>
                                    <option value="supplies">School Supplies</option>
                                    <option value="merchandise">UMak Merchandise</option>
                                </select>
                            </div>

                            <!-- Item 2 (Hidden by default) -->
                            <div id="item2Container" class="hidden">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Item 2 *</label>
                                <select id="orderItem2" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select Item</option>
                                    <option value="id lace">ID Lace</option>
                                    <option value="uniform">School Uniform</option>
                                    <option value="PE uniform">PE Uniform</option>
                                    <option value="nstp shirt">NSTP Shirt</option>
                                    <option value="patch">School Patch</option>
                                    <option value="book">Book/Manual</option>
                                    <option value="supplies">School Supplies</option>
                                    <option value="merchandise">UMak Merchandise</option>
                                </select>
                            </div>

                            <!-- Item 3 -->
                            <div id="item3Container" class="hidden">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Item 3 *</label>
                                <select id="orderItem3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select Item</option>
                                    <option value="id lace">ID Lace</option>
                                    <option value="uniform">School Uniform</option>
                                    <option value="PE uniform">PE Uniform</option>
                                    <option value="nstp shirt">NSTP Shirt</option>
                                    <option value="patch">School Patch</option>
                                    <option value="book">Book/Manual</option>
                                    <option value="supplies">School Supplies</option>
                                    <option value="merchandise">UMak Merchandise</option>
                                </select>
                            </div>

                            <!-- Item 4 -->
                            <div id="item4Container" class="hidden">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Item 4 *</label>
                                <select id="orderItem4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select Item</option>
                                    <option value="id lace">ID Lace</option>
                                    <option value="uniform">School Uniform</option>
                                    <option value="PE uniform">PE Uniform</option>
                                    <option value="nstp shirt">NSTP Shirt</option>
                                    <option value="patch">School Patch</option>
                                    <option value="book">Book/Manual</option>
                                    <option value="supplies">School Supplies</option>
                                    <option value="merchandise">UMak Merchandise</option>
                                </select>
                            </div>

                            <!-- Item 5 -->
                            <div id="item5Container" class="hidden">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Item 5 *</label>
                                <select id="orderItem5" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select Item</option>
                                    <option value="id lace">ID Lace</option>
                                    <option value="uniform">School Uniform</option>
                                    <option value="PE uniform">PE Uniform</option>
                                    <option value="nstp shirt">NSTP Shirt</option>
                                    <option value="patch">School Patch</option>
                                    <option value="book">Book/Manual</option>
                                    <option value="supplies">School Supplies</option>
                                    <option value="merchandise">UMak Merchandise</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Information Note -->
                    <div class="bg-orange-50 rounded-xl p-6">
                        <div class="flex gap-3">
                            <svg class="w-6 h-6 text-orange-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <div>
                                <h4 class="font-semibold text-orange-900 mb-1">Additional Details</h4>
                                <p class="text-sm text-orange-800">You can provide specific details (size, color, etc.) directly at the COOP when picking up your order.</p>
                                <p class="text-xs text-orange-700 mt-2" id="orderPreview">Your student information will be automatically attached.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" id="submitOrderBtn"
                            class="w-full bg-blue-900 text-white py-4 rounded-xl font-bold text-lg hover:bg-blue-800 transition-all hover:shadow-lg hover:scale-105 flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        Submit Order
                    </button>
                </form>
            </div>

            <!-- Order History Screen -->
            <div id="orderHistoryScreen" class="hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Order History</h2>
                    <button onclick="loadOrderHistory()" class="flex items-center gap-2 px-4 py-2 bg-blue-900 text-white rounded-lg hover:bg-blue-800 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        Refresh
                    </button>
                </div>
                <div id="ordersList" class="space-y-4">
                    <div class="text-center text-gray-500 py-8">Loading orders...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- OTP Verification Modal -->
    <div id="otpModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full shadow-2xl transform transition-all">
            <div class="text-center mb-6">
                <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-shield-alt text-blue-600 text-4xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Verify Your Order</h2>
                <p class="text-gray-600">We've sent a 6-digit code to</p>
                <p class="font-semibold text-blue-900" id="otpEmailDisplay">your email</p>
            </div>
            
            <div class="mb-6">
                <label class="block text-sm font-semibold text-gray-700 mb-3 text-center">Enter OTP Code</label>
                <input type="text" 
                       id="otpInput" 
                       maxlength="6" 
                       placeholder="000000"
                       class="w-full px-6 py-4 border-2 border-gray-300 rounded-xl text-center text-2xl font-bold tracking-widest focus:ring-4 focus:ring-blue-500 focus:border-blue-500 transition-all"
                       autocomplete="off">
                <p id="otpError" class="text-red-600 text-sm mt-2 hidden flex items-center justify-center gap-2">
                    <i class="fas fa-exclamation-circle"></i>
                    <span>Invalid OTP code</span>
                </p>
            </div>

            <div class="space-y-3">
                <button onclick="verifyOTP()" id="verifyOtpBtn"
                        class="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-4 rounded-xl font-bold text-lg hover:from-blue-700 hover:to-blue-800 transition-all hover:shadow-lg flex items-center justify-center gap-2">
                    <i class="fas fa-check-circle"></i>
                    <span>Verify & Place Order</span>
                </button>
                
                <button onclick="resendOTP()" id="resendOtpBtn"
                        class="w-full bg-gray-100 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-200 transition-all flex items-center justify-center gap-2">
                    <i class="fas fa-redo"></i>
                    <span>Resend Code</span>
                </button>
                
                <button onclick="closeOTPModal()"
                        class="w-full bg-white border-2 border-gray-300 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-50 transition-all flex items-center justify-center gap-2">
                    <i class="fas fa-times"></i>
                    <span>Cancel</span>
                </button>
            </div>

            <div class="mt-6 text-center">
                <p class="text-xs text-gray-500">
                    <i class="fas fa-info-circle mr-1"></i>
                    Check your spam folder if you don't see the email
                </p>
            </div>
        </div>
    </div>

    <!-- Order Result Modal -->
    <div id="orderResultModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full max-h-screen overflow-y-auto shadow-2xl">
            <div class="text-center mb-6">
                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce-once">
                    <i class="fas fa-check-circle text-green-600 text-5xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-green-600 mb-2">Order Placed Successfully!</h2>
                <p class="text-gray-600">Your order has been confirmed</p>
            </div>
            
            <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-xl p-6 mb-6">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs text-gray-600 font-medium">Queue Number</label>
                        <p id="resultQueueNumber" class="text-3xl font-bold text-blue-900">-</p>
                    </div>
                    <div>
                        <label class="text-xs text-gray-600 font-medium">Status</label>
                        <p class="text-sm font-bold text-orange-600 flex items-center gap-1 mt-2">
                            <i class="fas fa-hourglass-half"></i>
                            <span>PENDING</span>
                        </p>
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <label class="text-sm text-gray-600 font-semibold block mb-2">Items Ordered</label>
                <div class="bg-gray-50 rounded-lg p-4">
                    <p id="resultItem" class="font-semibold text-gray-800">-</p>
                </div>
            </div>

            <div id="qrCodeSection" class="text-center mb-6">
                <label class="text-sm text-gray-600 font-semibold block mb-3">Your QR Code</label>
                <div class="bg-white border-4 border-blue-900 rounded-xl p-4 inline-block">
                    <canvas id="orderQRCode" class="mx-auto"></canvas>
                </div>
                <p class="text-xs text-gray-500 mt-3 flex items-center justify-center gap-2">
                    <i class="fas fa-qrcode"></i>
                    <span>Show this QR code when picking up your order</span>
                </p>
            </div>

            <div class="bg-blue-50 border-l-4 border-blue-600 rounded-lg p-4 mb-6">
                <div class="flex gap-3">
                    <i class="fas fa-info-circle text-blue-600 text-lg mt-1"></i>
                    <div class="text-sm">
                        <p class="font-semibold text-blue-900 mb-1">Next Steps:</p>
                        <ul class="text-gray-700 space-y-1 text-xs">
                            <li>• You'll receive email updates about your order</li>
                            <li>• Check your order status in Order History</li>
                            <li>• Bring your QR code when picking up</li>
                        </ul>
                    </div>
                </div>
            </div>

            <button onclick="closeOrderResult()"
                    class="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-4 rounded-xl font-bold text-lg hover:from-blue-700 hover:to-blue-800 transition-all hover:shadow-lg flex items-center justify-center gap-2">
                <i class="fas fa-check"></i>
                <span>Done</span>
            </button>
        </div>
    </div>

    <script>
        const API_BASE = '../../php/api';
        let studentData = null;
        let inventoryStock = {};
        let pendingOrderData = null; // Store order data for OTP verification
        let currentOTPCode = null; // Store OTP for verification

        // Update current date/time
        function updateDateTime() {
            const now = new Date();
            const options = { 
                weekday: 'short', 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            const dateTimeEl = document.getElementById('currentDateTime');
            if (dateTimeEl) {
                dateTimeEl.textContent = now.toLocaleDateString('en-US', options);
            }
        }

        // Update time every minute
        setInterval(updateDateTime, 60000);
        updateDateTime();

        // Fetch inventory stock status
        async function fetchInventoryStatus() {
            try {
                const response = await fetch(`${API_BASE}/inventory_status.php`);
                const result = await response.json();
                
                if (result.success && result.data.items) {
                    // Convert items array to lookup object for backward compatibility
                    inventoryStock = {};
                    result.data.items.forEach(item => {
                        inventoryStock[item.item_name] = item.is_available && item.stock_quantity > 0;
                    });
                    updateItemSelects();
                }
            } catch (error) {
                console.error('Error fetching inventory status:', error);
            }
        }

        // Update all item select dropdowns with stock status
        function updateItemSelects() {
            const selectIds = ['orderItem1', 'orderItem2', 'orderItem3', 'orderItem4', 'orderItem5'];
            
            selectIds.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (!select) return;
                
                // Store original text for each option
                Array.from(select.options).forEach(option => {
                    if (!option.value) return; // Skip "Select Item" option
                    
                    // Store original text if not already stored
                    if (!option.dataset.originalText) {
                        option.dataset.originalText = option.textContent.trim();
                    }
                    
                    const itemName = option.dataset.originalText;
                    const isInStock = inventoryStock[itemName];
                    
                    if (isInStock === false) {
                        option.disabled = true;
                        option.textContent = itemName + ' (Out of Stock)';
                        option.style.color = '#999';
                        option.style.fontStyle = 'italic';
                        option.style.backgroundColor = '#f5f5f5';
                    } else {
                        option.disabled = false;
                        option.textContent = itemName;
                        option.style.color = '';
                        option.style.fontStyle = '';
                        option.style.backgroundColor = '';
                    }
                });
            });
        }

        // Check if logged in
        async function checkSession() {
            try {
                const response = await fetch(`${API_BASE}/student/student_session.php`);
                const result = await response.json();

                if (!result.logged_in) {
                    window.location.href = 'student_login.html';
                    return;
                }

                studentData = result.data;
                updateUI();
            } catch (error) {
                console.error('Session check error:', error);
                window.location.href = 'student_login.html';
            }
        }

        function updateUI() {
            if (!studentData) return;

            const welcomeIcon = '<i class="fas fa-circle text-green-400 text-xs animate-pulse"></i>';
            document.getElementById('welcomeText').innerHTML = `${welcomeIcon} Welcome back, ${studentData.first_name}!`;
            
            // Update profile
            const fullName = `${studentData.first_name} ${studentData.middle_initial ? studentData.middle_initial + '. ' : ''}${studentData.last_name}`;
            document.getElementById('profileStudentId').textContent = studentData.student_id;
            document.getElementById('profileStudentIdDisplay').textContent = studentData.student_id;
            document.getElementById('profileName').textContent = fullName;
            document.getElementById('profileFullName').textContent = fullName;
            document.getElementById('profileEmail').textContent = studentData.email;
            document.getElementById('profileCollege').textContent = studentData.college || 'Not specified';
            document.getElementById('profileProgram').textContent = studentData.program || 'Not specified';
            document.getElementById('profileYear').textContent = studentData.year_level ? `${studentData.year_level}${getOrdinalSuffix(studentData.year_level)} Year` : 'Not specified';
            document.getElementById('profileSection').textContent = studentData.section || 'Not specified';

            // Update initials
            const initials = (studentData.first_name.charAt(0) + studentData.last_name.charAt(0)).toUpperCase();
            document.getElementById('profileInitials').textContent = initials;

            // Update order preview
            document.getElementById('orderPreview').textContent = 
                `${studentData.first_name} ${studentData.last_name} | ${studentData.student_id} | ${studentData.email}`;
        }

        // Toggle profile edit mode
        function toggleEditProfile() {
            const viewMode = document.getElementById('profileViewMode');
            const editMode = document.getElementById('profileEditMode');
            const editBtn = document.getElementById('editProfileBtn');

            viewMode.classList.add('hidden');
            editMode.classList.remove('hidden');
            editBtn.classList.add('hidden');

            // Populate edit form with current data
            document.getElementById('editFirstName').value = studentData.first_name || '';
            document.getElementById('editLastName').value = studentData.last_name || '';
            document.getElementById('editMiddleInitial').value = studentData.middle_initial || '';
            document.getElementById('editEmailDisplay').textContent = studentData.email || '';
            document.getElementById('editCollege').value = studentData.college || '';
            document.getElementById('editProgram').value = studentData.program || '';
            document.getElementById('editYearLevel').value = studentData.year_level || '';
            document.getElementById('editSection').value = studentData.section || '';
        }

        // Cancel profile editing
        function cancelEditProfile() {
            const viewMode = document.getElementById('profileViewMode');
            const editMode = document.getElementById('profileEditMode');
            const editBtn = document.getElementById('editProfileBtn');

            viewMode.classList.remove('hidden');
            editMode.classList.add('hidden');
            editBtn.classList.remove('hidden');
        }

        // Toggle change password form
        function toggleChangePassword() {
            const form = document.getElementById('changePasswordForm');
            const btn = document.getElementById('changePasswordBtnText');
            
            if (form.classList.contains('hidden')) {
                form.classList.remove('hidden');
                btn.textContent = 'Cancel';
                // Clear form
                document.getElementById('passwordChangeForm').reset();
            } else {
                form.classList.add('hidden');
                btn.textContent = 'Change Password';
                document.getElementById('passwordChangeForm').reset();
            }
        }

        // Toggle password visibility
        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            const icon = input.nextElementSibling.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        // Handle password change form submission
        document.addEventListener('DOMContentLoaded', function() {
            const passwordChangeForm = document.getElementById('passwordChangeForm');
            if (passwordChangeForm) {
                passwordChangeForm.addEventListener('submit', async function(e) {
                    e.preventDefault();

                    const submitBtn = e.target.querySelector('button[type="submit"]');
                    const originalText = submitBtn.innerHTML;
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Updating...';

                    const currentPassword = document.getElementById('currentPassword').value;
                    const newPassword = document.getElementById('newPassword').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;

                    // Client-side validation
                    if (newPassword !== confirmPassword) {
                        notificationManager.error('New passwords do not match');
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = originalText;
                        return;
                    }

                    if (newPassword.length < 6) {
                        notificationManager.error('Password must be at least 6 characters long');
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = originalText;
                        return;
                    }

                    try {
                        const response = await fetch(`${API_BASE}/student/change_password.php`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                current_password: currentPassword,
                                new_password: newPassword,
                                confirm_password: confirmPassword
                            })
                        });

                        const result = await response.json();

                        if (result.success) {
                            notificationManager.success('Password changed successfully');
                            
                            // Show additional success message
                            setTimeout(() => {
                                notificationManager.success('Your account is now more secure');
                            }, 1500);
                            
                            // Reset form and hide
                            setTimeout(() => {
                                toggleChangePassword();
                            }, 2500);
                        } else {
                            notificationManager.error(result.message);
                            
                            // Show helpful tip
                            if (result.message.includes('Current password')) {
                                setTimeout(() => {
                                    notificationManager.error('Tip: Make sure you entered your current password correctly');
                                }, 2000);
                            }
                        }
                    } catch (error) {
                        console.error('Password change error:', error);
                        notificationManager.error('An error occurred. Please check your connection and try again.');
                    } finally {
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = originalText;
                    }
                });
            }
        });

        // Handle profile update form submission
        document.getElementById('editProfileForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<svg class="w-5 h-5 animate-spin inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> Saving...';

            const updatedData = {
                first_name: document.getElementById('editFirstName').value.trim(),
                last_name: document.getElementById('editLastName').value.trim(),
                middle_initial: document.getElementById('editMiddleInitial').value.trim(),
                college: document.getElementById('editCollege').value.trim(),
                program: document.getElementById('editProgram').value.trim(),
                year_level: document.getElementById('editYearLevel').value,
                section: document.getElementById('editSection').value.trim()
            };

            // Client-side validation
            if (!updatedData.first_name || !updatedData.last_name) {
                notificationManager.error('First name and last name are required');
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/student/update_profile.php`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedData)
                });

                const result = await response.json();

                if (result.success) {
                    // Update local student data
                    studentData = result.data;
                    updateUI();
                    cancelEditProfile();
                    
                    // Show success notification with details
                    notificationManager.success('Profile updated successfully');
                    
                    // Show additional notification after a delay
                    setTimeout(() => {
                        notificationManager.success('Your changes have been saved to the database');
                    }, 1500);
                } else {
                    // Show specific error message
                    let errorMsg = result.message || 'Failed to update profile';
                    notificationManager.error(errorMsg);
                }
            } catch (error) {
                console.error('Profile update error:', error);
                notificationManager.error('An error occurred. Please check your connection and try again.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        });

        function getOrdinalSuffix(num) {
            const j = num % 10, k = num % 100;
            if (j == 1 && k != 11) return "st";
            if (j == 2 && k != 12) return "nd";
            if (j == 3 && k != 13) return "rd";
            return "th";
        }

        function showScreen(screenId) {
            // Hide all screens
            document.querySelectorAll('#contentArea > div').forEach(div => div.classList.add('hidden'));
            // Show selected screen
            document.getElementById(screenId).classList.remove('hidden');
        }

        let selectedQuantity = 1; // Track selected quantity

        function selectQuantity(qty) {
            selectedQuantity = qty;
            
            // Define classes
            const activeClass = 'py-3 px-4 border-2 border-blue-900 bg-blue-900 text-white rounded-lg font-bold hover:bg-blue-800 transition-all';
            const inactiveClass = 'py-3 px-4 border-2 border-gray-300 bg-white text-gray-700 rounded-lg font-bold hover:border-blue-900 hover:bg-blue-50 transition-all';
            
            // Update all quantity buttons
            for (let i = 1; i <= 5; i++) {
                const btn = document.getElementById(`qty${i}Btn`);
                if (btn) {
                    btn.className = i === qty ? activeClass : inactiveClass;
                }
            }
            
            // Show/hide item containers based on quantity
            for (let i = 2; i <= 5; i++) {
                const container = document.getElementById(`item${i}Container`);
                const select = document.getElementById(`orderItem${i}`);
                if (container && select) {
                    if (i <= qty) {
                        container.classList.remove('hidden');
                        select.setAttribute('required', 'required');
                    } else {
                        container.classList.add('hidden');
                        select.removeAttribute('required');
                        select.value = ''; // Clear selection
                    }
                }
            }
        }

        function showQuickOrder() {
            showScreen('quickOrderScreen');
            selectQuantity(1); // Reset to 1 item
            // Populate inventory dropdowns
            loadInventoryItems();
        }
        
        async function loadInventoryItems() {
            // Populate all item select dropdowns with inventory
            await populateInventorySelect('orderItem1', false);
            await populateInventorySelect('orderItem2', false);
            await populateInventorySelect('orderItem3', false);
            await populateInventorySelect('orderItem4', false);
            await populateInventorySelect('orderItem5', false);
        }

        function showProfile() {
            showScreen('profileScreen');
        }

        async function showOrderHistory() {
            showScreen('orderHistoryScreen');
            await loadOrderHistory();
        }

        async function loadOrderHistory() {
            const ordersList = document.getElementById('ordersList');
            ordersList.innerHTML = '<div class="text-center text-gray-500 py-8"><i class="fas fa-spinner fa-spin text-3xl mb-3"></i><p>Loading orders...</p></div>';

            try {
                const response = await fetch(`${API_BASE}/admin/check_status.php?email=${encodeURIComponent(studentData.email)}`);
                const result = await response.json();

                if (result.success && result.data.orders.length > 0) {
                    const statusConfig = {
                        'pending': {
                            color: 'bg-yellow-100 text-yellow-800 border-yellow-300',
                            icon: 'fa-hourglass-half',
                            iconColor: 'text-yellow-600'
                        },
                        'processing': {
                            color: 'bg-blue-100 text-blue-800 border-blue-300',
                            icon: 'fa-cog fa-spin',
                            iconColor: 'text-blue-600'
                        },
                        'ready': {
                            color: 'bg-purple-100 text-purple-800 border-purple-300',
                            icon: 'fa-check-circle',
                            iconColor: 'text-purple-600'
                        },
                        'completed': {
                            color: 'bg-green-100 text-green-800 border-green-300',
                            icon: 'fa-trophy',
                            iconColor: 'text-green-600'
                        },
                        'cancelled': {
                            color: 'bg-red-100 text-red-800 border-red-300',
                            icon: 'fa-times-circle',
                            iconColor: 'text-red-600'
                        }
                    };

                    ordersList.innerHTML = result.data.orders.map(order => {
                        const config = statusConfig[order.order_status] || statusConfig['pending'];
                        const orderDate = new Date(order.created_at);
                        const formattedDate = orderDate.toLocaleDateString('en-US', { 
                            month: 'short', 
                            day: 'numeric', 
                            year: 'numeric' 
                        });
                        const formattedTime = orderDate.toLocaleTimeString('en-US', { 
                            hour: '2-digit', 
                            minute: '2-digit' 
                        });

                        return `
                        <div class="border-2 ${config.color.includes('bg-green') ? 'border-green-200' : 'border-gray-200'} rounded-xl p-6 hover:shadow-lg transition-all transform hover:-translate-y-1">
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-16 h-16 bg-gradient-to-br from-blue-600 to-blue-800 rounded-xl flex items-center justify-center text-white font-bold text-xl shadow-lg">
                                        ${order.queue_number}
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500 font-semibold uppercase tracking-wide">Queue Number</p>
                                        <p class="text-sm text-gray-600 mt-1">
                                            <i class="fas fa-calendar-alt mr-1"></i>${formattedDate}
                                            <span class="mx-2">•</span>
                                            <i class="fas fa-clock mr-1"></i>${formattedTime}
                                        </p>
                                    </div>
                                </div>
                                <span class="px-4 py-2 rounded-full text-xs font-bold border-2 ${config.color} flex items-center gap-2">
                                    <i class="fas ${config.icon} ${config.iconColor}"></i>
                                    ${order.order_status.toUpperCase()}
                                </span>
                            </div>
                            
                            <div class="bg-gray-50 rounded-lg p-4 mb-3">
                                <p class="text-xs text-gray-500 font-semibold mb-2">ITEMS ORDERED</p>
                                <p class="font-semibold text-gray-800"><i class="fas fa-shopping-bag text-blue-600 mr-2"></i>${order.item_ordered}</p>
                            </div>

                            ${order.order_status === 'ready' ? `
                                <div class="bg-purple-50 border-l-4 border-purple-600 rounded-lg p-3 flex items-start gap-3">
                                    <i class="fas fa-bell text-purple-600 text-lg mt-1"></i>
                                    <div class="text-sm">
                                        <p class="font-bold text-purple-900">Ready for Pickup!</p>
                                        <p class="text-purple-700 text-xs mt-1">Your order is ready at the COOP counter</p>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    `}).join('');
                } else {
                    ordersList.innerHTML = `
                        <div class="text-center py-12">
                            <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-inbox text-gray-400 text-5xl"></i>
                            </div>
                            <p class="text-gray-500 font-semibold text-lg">No orders found</p>
                            <p class="text-gray-400 text-sm mt-2">You haven't placed any orders yet</p>
                            <button onclick="showQuickOrder()" class="mt-6 px-6 py-3 bg-blue-900 text-white rounded-lg font-semibold hover:bg-blue-800 transition-all flex items-center gap-2 mx-auto">
                                <i class="fas fa-plus"></i>
                                <span>Create Your First Order</span>
                            </button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading orders:', error);
                ordersList.innerHTML = `
                    <div class="text-center py-12">
                        <div class="w-24 h-24 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-exclamation-triangle text-red-500 text-5xl"></i>
                        </div>
                        <p class="text-red-500 font-semibold text-lg">Failed to load orders</p>
                        <p class="text-gray-500 text-sm mt-2">Please try again later</p>
                        <button onclick="loadOrderHistory()" class="mt-6 px-6 py-3 bg-blue-900 text-white rounded-lg font-semibold hover:bg-blue-800 transition-all flex items-center gap-2 mx-auto">
                            <i class="fas fa-redo"></i>
                            <span>Try Again</span>
                        </button>
                    </div>
                `;
            }
        }

        document.getElementById('quickOrderForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submitOrderBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Sending OTP...';

            // Collect items based on quantity
            const items = [];
            for (let i = 1; i <= selectedQuantity; i++) {
                const itemValue = document.getElementById(`orderItem${i}`).value;
                if (itemValue) {
                    items.push(itemValue);
                }
            }
            const itemsOrdered = items.join(', ');

            pendingOrderData = {
                studentId: studentData.student_id,
                fname: studentData.first_name,
                lname: studentData.last_name,
                minitial: studentData.middle_initial || '',
                email: studentData.email,
                college: studentData.college,
                program: studentData.program,
                year: studentData.year_level,
                section: studentData.section || '',
                purchasing: itemsOrdered,
                notes: ''
            };

            try {
                // Create order and send OTP
                const createResponse = await fetch(`${API_BASE}/student/create_order.php`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(pendingOrderData)
                });

                const createResult = await createResponse.json();

                if (!createResult.success) {
                    // Show specific error messages
                    let errorMsg = createResult.message || 'Failed to create order';
                    
                    // Add helpful hints for common errors
                    if (errorMsg.includes('email')) {
                        notificationManager.error(errorMsg);
                        
                        // Additional guidance
                        setTimeout(() => {
                            if (errorMsg.includes('already registered')) {
                                notificationManager.error('Tip: Use the email associated with your student account');
                            } else if (errorMsg.includes('Invalid') || errorMsg.includes('UMak')) {
                                notificationManager.error('Tip: Use your @umak.edu.ph email address');
                            }
                        }, 2000);
                    } else {
                        notificationManager.error(errorMsg);
                    }
                    
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Submit Order';
                    return;
                }

                // Store OTP code for verification
                currentOTPCode = createResult.data.otp_code;

                // Show OTP modal
                document.getElementById('otpEmailDisplay').textContent = studentData.email;
                document.getElementById('otpInput').value = '';
                document.getElementById('otpError').classList.add('hidden');
                document.getElementById('otpModal').classList.remove('hidden');
                
                // Focus on OTP input
                setTimeout(() => {
                    document.getElementById('otpInput').focus();
                }, 300);

                // Show success notification with details
                notificationManager.success('OTP sent successfully to ' + studentData.email);
                
                // Show additional tip
                setTimeout(() => {
                    notificationManager.success('Check your email inbox (and spam folder) for the 6-digit code');
                }, 2000);

            } catch (error) {
                console.error('Order submission error:', error);
                notificationManager.error('An error occurred. Please try again.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Submit Order';
            }
        });

        // Verify OTP and place order
        async function verifyOTP() {
            const otpInput = document.getElementById('otpInput').value.trim();
            const errorEl = document.getElementById('otpError');
            const verifyBtn = document.getElementById('verifyOtpBtn');

            if (!otpInput || otpInput.length !== 6) {
                errorEl.querySelector('span').textContent = 'Please enter a 6-digit code';
                errorEl.classList.remove('hidden');
                return;
            }

            verifyBtn.disabled = true;
            verifyBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Verifying...';
            errorEl.classList.add('hidden');

            try {
                const verifyResponse = await fetch(`${API_BASE}/student/verify_otp.php`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: studentData.email,
                        otp_code: otpInput,
                        otp_type: 'order',
                        order_data: {
                            purchasing: pendingOrderData.purchasing,
                            studentId: studentData.student_id,
                            fname: studentData.first_name,
                            lname: studentData.last_name,
                            minitial: studentData.middle_initial || '',
                            college: studentData.college,
                            program: studentData.program,
                            year: studentData.year_level,
                            section: studentData.section || ''
                        }
                    })
                });

                const verifyResult = await verifyResponse.json();

                if (verifyResult.success) {
                    // Close OTP modal
                    closeOTPModal();

                    // Show result modal with QR code
                    document.getElementById('resultQueueNumber').textContent = verifyResult.data.queue_number;
                    document.getElementById('resultItem').textContent = pendingOrderData.purchasing;
                    
                    // Generate QR code
                    const qrData = JSON.stringify({
                        queue_number: verifyResult.data.queue_number,
                        email: studentData.email,
                        timestamp: new Date().toISOString(),
                        type: 'umak_coop_order'
                    });

                    const canvas = document.getElementById('orderQRCode');
                    QRCode.toCanvas(canvas, qrData, {
                        width: 200,
                        margin: 2,
                        color: { dark: '#1e3a8a', light: '#ffffff' }
                    });

                    document.getElementById('orderResultModal').classList.remove('hidden');
                    document.getElementById('quickOrderForm').reset();
                    selectQuantity(1); // Reset to 1 item
                    
                    // Show success notification
                    notificationManager.success('Order placed successfully! Queue Number: ' + verifyResult.data.queue_number);
                    
                    // Additional celebration notification
                    setTimeout(() => {
                        notificationManager.success('Check your email for order confirmation');
                    }, 2000);
                } else {
                    errorEl.querySelector('span').textContent = verifyResult.message || 'Invalid OTP code';
                    errorEl.classList.remove('hidden');
                }
            } catch (error) {
                console.error('OTP verification error:', error);
                errorEl.querySelector('span').textContent = 'An error occurred. Please try again.';
                errorEl.classList.remove('hidden');
            } finally {
                verifyBtn.disabled = false;
                verifyBtn.innerHTML = '<i class="fas fa-check-circle mr-2"></i>Verify & Place Order';
            }
        }

        // Resend OTP
        async function resendOTP() {
            const resendBtn = document.getElementById('resendOtpBtn');
            resendBtn.disabled = true;
            resendBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Sending...';

            try {
                const response = await fetch(`${API_BASE}/student/resend_otp.php`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: studentData.email,
                        otp_type: 'order'
                    })
                });

                const result = await response.json();

                if (result.success) {
                    currentOTPCode = result.data.otp_code;
                    notificationManager.success('New OTP sent successfully');
                    
                    // Clear the input field for new code
                    document.getElementById('otpInput').value = '';
                    document.getElementById('otpError').classList.add('hidden');
                    
                    // Show additional tip
                    setTimeout(() => {
                        notificationManager.success('The new code should arrive in a few seconds');
                    }, 1500);
                } else {
                    notificationManager.error(result.message || 'Failed to resend OTP');
                }
            } catch (error) {
                console.error('Resend OTP error:', error);
                notificationManager.error('An error occurred. Please try again.');
            } finally {
                resendBtn.disabled = false;
                resendBtn.innerHTML = '<i class="fas fa-redo mr-2"></i>Resend Code';
            }
        }

        // Close OTP modal
        function closeOTPModal() {
            document.getElementById('otpModal').classList.add('hidden');
            document.getElementById('otpInput').value = '';
            document.getElementById('otpError').classList.add('hidden');
            pendingOrderData = null;
            currentOTPCode = null;
        }

        // Allow Enter key to submit OTP
        document.addEventListener('DOMContentLoaded', function() {
            const otpInput = document.getElementById('otpInput');
            if (otpInput) {
                otpInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        verifyOTP();
                    }
                });
                
                // Auto-format OTP input (numbers only)
                otpInput.addEventListener('input', function(e) {
                    this.value = this.value.replace(/[^0-9]/g, '');
                });
            }
        });

        function closeOrderResult() {
            document.getElementById('orderResultModal').classList.add('hidden');
            
            // Show reminder notification
            notificationManager.success('Order saved! Check "Order History" to track your order');
            
            // Redirect to order history after a brief delay
            setTimeout(() => {
                showOrderHistory();
            }, 1500);
        }

        async function logout() {
            try {
                await fetch(`${API_BASE}/student/student_session.php`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'logout' })
                });
                window.location.href = 'student_login.html';
            } catch (error) {
                console.error('Logout error:', error);
                window.location.href = 'student_login.html';
            }
        }

        // Initialize
        checkSession();
        fetchInventoryStatus();
    </script>

    <style>
        @keyframes bounce-once {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        .animate-bounce-once {
            animation: bounce-once 0.6s ease-in-out;
        }
        
        @keyframes fade-in {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        
        #otpModal > div,
        #orderResultModal > div {
            animation: fade-in 0.3s ease-out;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</body>
</html>
